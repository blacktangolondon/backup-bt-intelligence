<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>BT-intelligence</title>
  <link rel="stylesheet" href="styles.css" />

  <!-- Librerie esistenti -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css" />
  <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>

  <!-- Lightweight Charts per gli spread -->
  <script src="https://cdn.jsdelivr.net/npm/lightweight-charts/dist/lightweight-charts.standalone.production.js"></script>

  <!-- (Se usi la pagina portafoglio) -->
  <script type="module" src="portfolio.js"></script>

  <!-- Fix layout: sidebar fissa + main a tutta larghezza/altezza -->
  <style>
    :root { --sidebar-w: 260px; }

    /* Layout base (aggiunta) */
    html, body { height: 100%; margin: 0; }
    body { display: flex; background: #000; color: #fff; }

    /* Sidebar a sinistra (aggiunta) */
    #sidebar {
      flex: 0 0 var(--sidebar-w);
      width: var(--sidebar-w);
      height: 100vh;
      overflow: auto;
      position: sticky; top: 0;
      z-index: 3;
    }

    /* Main area riempie tutto lo spazio (aggiunta) */
    #main-content, .main-section {
      flex: 1 1 auto;
      min-width: 0;           /* evita schiacciamenti */
      height: 100vh;
      overflow: auto;
      padding: 12px 16px;
      position: relative;
    }

    .content-block { width: 100%; }

    /* Supporto Tactical (iframe) — opzionale, non interferisce se non usato */
    #tactical-embed {
      display: block;
      width: 100%;
      height: calc(100vh - 24px);
    }
    #tactical-embed iframe {
      display: block;
      width: 100%;
      height: 100%;
      border: 0;
    }

    /* Fix dimensioni per il grafico spread (tuo codice, invariato ma compatibile col layout) */
    #main-content { position: relative; }

    /* block5: contenitore degli spread */
    #block5.content-block {
      /* lo lascio visibile per design; se vuoi tenerlo chiuso all'avvio, metti display:none e il fix JS lo aprirà al click */
      display: block;
      min-height: 480px;
      height: calc(100vh - 40px);
    }

    /* la pagina spread dentro block5 */
    #spread-page {
      position: relative;
      width: 100%;
      height: 100%;
    }

    /* contenitore del grafico */
    #spread-chart {
      width: 100%;
      height: 100%;
    }
  </style>
</head>

<body>
  <!-- Sidebar -->
  <div id="sidebar">
    <div id="sidebar-title">BT-intelligence</div>
    <div id="sidebar-search-container">
      <input type="text" id="sidebar-search" placeholder="Search instruments..." />
      <button id="sidebar-search-clear">✕</button>
    </div>
    <ul id="sidebar-list"></ul>
  </div>

  <!-- Main content grid -->
  <div id="main-content">
    <div id="block1" class="content-block">
      <div class="tradingview-widget-container"></div>
      <button id="fullscreen-button" class="external-fullscreen-btn">
        <span class="arrow">&#8598;</span>
        <span class="arrow">&#8599;</span><br>
        <span class="arrow">&#8601;</span>
        <span class="arrow">&#8600;</span>
      </button>
    </div>

    <div id="block2" class="content-block">
      <div id="symbol-info-container" class="tradingview-widget-container"></div>
    </div>

    <div id="block3" class="content-block">
      <div id="block3-tabs">
        <button data-tab="trendscore" class="active-tab">TREND SCORE</button>
        <button data-tab="tradingview">TradingView</button>
      </div>
      <div id="block3-content">
        <div id="block3-trendscore"></div>
        <div id="block3-tradingview" style="display:none;"></div>
      </div>
    </div>

    <div id="block4" class="content-block"></div>

    <!-- ✅ BLOCK 5 REINTRODOTTO: contiene la pagina degli spread e l’unico #spread-chart -->
    <div id="block5" class="content-block">
      <section id="spread-page">
        <div id="spread-chart"></div>
      </section>
    </div>
  </div>

  <!-- Altre sezioni opzionali -->
  <div id="portfolio-builder-template" class="main-section" style="display:none;"></div>
  <div id="thematic-portfolio-template" class="main-section" style="display:none;"></div>
  <div id="portfolios-template" class="main-section" style="display:none;"></div>

  <!-- Popup YouTube -->
  <div id="youtube-popup" style="display:none;">
    <div id="youtube-popup-header">
      LIVE TV
      <button id="youtube-popup-close">&times;</button>
    </div>
    <div id="youtube-popup-content">
      <input type="text" id="youtube-url" placeholder="Enter YouTube URL" />
      <button onclick="updateYouTubePlayer()">Update Player</button>
      <iframe id="youtube-iframe" width="100%" height="150" frameborder="0"
              allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
              allowfullscreen></iframe>
    </div>
  </div>

  <!-- Entry point principale -->
  <script type="module" src="main.js"></script>

  <!-- Moduli per sidebar e grafico spread -->
  <script type="module" src="spreadView.js"></script>
  <script type="module">
    import { generateSidebarContent } from './sidebar.js';
    generateSidebarContent();
  </script>

  <!-- Bridge: dopo il click su uno spread, assicurati che block5 sia visibile -->
  <script>
    // Se preferisci che block5 resti nascosto finché non clicchi uno spread,
    // metti: document.getElementById('block5').style.display = 'none';
    // e lascia questo bridge che lo riapre al click.
    document.addEventListener('click', (e) => {
      if (e.target.closest('.nd-spread')) {
        // Esegui DOPO gli handler della sidebar (che chiamano showSpreadPage)
        setTimeout(() => {
          const b5 = document.getElementById('block5');
          if (b5) b5.style.display = 'block';
        }, 0);
      }
    });
  </script>
</body>
</html>
